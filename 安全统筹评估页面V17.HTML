<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>中国移动 - 安全统筹域评估 (新权重-V4-最终版)</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.2/package/dist/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* --- 基本样式 --- */
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; line-height: 1.6; margin: 20px; background-color: #f4f7fa; color: #333; }
        h1 { color: #005BAC; text-align: center; margin-bottom: 30px; }
        .assessment-section { border: 1px solid #dce1e6; padding: 20px; margin-bottom: 20px; border-radius: 8px; background-color: #ffffff; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .indicator-l2 { font-size: 1.3em; font-weight: 600; color: #005BAC; margin-bottom: 20px; border-bottom: 2px solid #005BAC; padding-bottom: 8px; }
        .indicator-l3 { margin-bottom: 20px; }
        .indicator-l3 h5 { margin-bottom: 10px; color: #1a2b47; font-weight: 600; }
        .score-option label { display: block; margin-bottom: 8px; padding: 10px 15px; border-radius: 6px; cursor: pointer; background-color: #f8f9fa; border: 1px solid #dee2e6; transition: background-color 0.2s ease, border-color 0.2s ease; }
        .score-option input[type="radio"] { margin-right: 12px; vertical-align: middle; }
        .score-option label:hover { background-color: #e9ecef; border-color: #ced4da; }
        .score-option input[type="radio"]:checked + span { font-weight: bold; }

        /* --- Button Styles --- */
        button { padding: 12px 25px; font-size: 1.1em; font-weight: 600; color: #fff; border: none; border-radius: 5px; cursor: pointer; margin-top: 15px; margin-right: 10px; transition: background-color 0.2s ease; }
        button:hover { opacity: 0.9; }
        #calculateBtn { background-color: #005BAC; }
        #calculateBtn:hover { background-color: #004a8c; }
        #generateTextReportBtn { background-color: #f0ad4e; }
        #generateTextReportBtn:hover { background-color: #ec971f; }
        #generateWordReportBtn { background-color: #5bc0de; }
        #generateWordReportBtn:hover { background-color: #31b0d5; }
        #generateExcelBtn { background-color: #28a745; }
        #generateExcelBtn:hover { background-color: #218838; }
        #aiReportBtn { background-color: #6f42c1; } /* 紫色 */
        #aiReportBtn:hover { background-color: #5a379a; }

        /* --- 结果区域样式 --- */
        #results { margin-top: 30px; border: 1px solid #dce1e6; padding: 25px; border-radius: 8px; background-color: #eaf2fa; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        #results h2 { color: #005BAC; text-align: center; margin-bottom: 20px; }
        #scores h4 { color: #004a8c; margin-top: 15px; margin-bottom: 15px; padding-bottom: 5px; border-bottom: 1px solid #cdd5de; }
        #scores .l2-score-item { margin-bottom: 18px; padding-left: 15px; border-left: 4px solid #a8c7e0; background-color: rgba(255, 255, 255, 0.4); padding-top: 10px; padding-bottom: 10px; padding-right: 10px; border-radius: 0 5px 5px 0; }
        #scores .l2-score-item h5 { font-weight: 700; color: #004a8c; margin-bottom: 10px; margin-top: 0; font-size: 1.1em; }
        #scores .l3-score-list { list-style-type: circle; margin-left: 20px; padding-left: 5px; font-size: 0.95em; color: #333; }
        #scores .l3-score-list li { margin-bottom: 5px; }
        #scores .l3-score-list li::marker { color: #005BAC; font-size: 1.1em; }
        #scores hr { border: 0; height: 1px; background-color: #cdd5de; margin: 25px 0; }
        #scores h4:last-of-type { border-bottom: none; font-size: 1.2em; color: #005BAC; text-align: right; margin-top: 0; }
        #calculationDetails { margin-top: 25px; padding: 15px; background-color: #f0f0f0; border: 1px solid #ccc; border-radius: 5px; font-family: 'Courier New', Courier, monospace; font-size: 0.9em; white-space: pre-wrap; color: #444; }
        #calculationDetails h4 { margin-top: 0; margin-bottom: 10px; color: #005BAC; }

        /* --- 图表布局 --- */
        #chartRow { display: flex; justify-content: space-around; align-items: flex-start; flex-wrap: wrap; margin-top: 25px; margin-bottom: 15px; }
        #radarChartContainer, #barChartContainer {
            max-width: 48%; flex: 1 1 400px; margin: 10px; padding: 15px; background-color: #fff;
            border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); min-width: 300px; height: 400px; /* 固定高度 */
            display: flex; justify-content: center; align-items: center;
        }
        #radarChartContainer canvas, #barChartContainer canvas { max-height: 100%; max-width: 100%; }

        /* --- AI 分析区域 --- */
        #aiAnalysisSection { margin-top: 30px; padding-top: 25px; border-top: 1px solid #cdd5de; }
        #aiAnalysisSection h3 { color: #005BAC; text-align: center; margin-bottom: 20px; }
        #aiAnalysisContent { background-color: #fff; border: 1px solid #dce1e6; padding: 20px 25px; border-radius: 8px; line-height: 1.7; color: #333; box-shadow: 0 1px 3px rgba(0,0,0,0.04); }
        #aiAnalysisContent h5 { color: #005BAC; margin-top: 18px; margin-bottom: 8px; font-size: 1.1em; border-bottom: 1px dotted #ccc; padding-bottom: 4px; }
        #aiAnalysisContent h5:first-of-type { margin-top: 0; }
        #aiAnalysisContent ul { list-style-type: disc; margin-left: 20px; padding-left: 10px; margin-bottom: 15px; }
        #aiAnalysisContent strong { color: #004a8c; }
        #aiAnalysisContent .low-score { color: #dc3545; font-weight: bold; }
        #aiAnalysisContent .medium-score { color: #ffc107; font-weight: bold; }
        #aiAnalysisContent .high-score { color: #28a745; font-weight: bold; }
        /* --- 文本报告输出区域 --- */
        #textReportContainer { margin-top: 30px; }
        #textReportContainer h3 { color: #005BAC; text-align: center; margin-bottom: 10px; border-top: 1px solid #cdd5de; padding-top: 25px; }
        #textReportContainer p { text-align: center; font-size: 0.9em; color: #555; margin-bottom: 15px; }
        #textReportOutput { width: 98%; padding: 15px; font-family: 'Courier New', Courier, monospace; font-size: 0.9em; border: 1px solid #ccc; border-radius: 5px; background-color: #fdfdfd; line-height: 1.5; box-shadow: inset 0 1px 3px rgba(0,0,0,0.1); }
        /* --- 底部注释样式 --- */
        #results .notes { font-size: 0.9em; color: #555; margin-top: 30px; padding-top: 15px; border-top: 1px dashed #cdd5de; }
        #results .notes ul { padding-left: 18px; list-style-position: outside;}
        #results .notes li { margin-bottom: 5px;}
        /* --- 响应式布局 --- */
        @media (max-width: 900px) {
             #chartRow { flex-direction: column; align-items: center; }
             #radarChartContainer, #barChartContainer {
                  max-width: 90%; flex-basis: auto; margin: 15px 0; height: 350px;
            }
        }
    </style>
</head>
<body>

    <h1>安全统筹域评估 (新权重-V4-最终版)</h1>
    <p style="text-align: center; margin-bottom: 30px;">请根据实际情况，为每个三级指标选择最符合的描述。</p>

    <form id="assessmentForm">
        <div class="assessment-section"><h3 class="indicator-l2">一、机构设置 (权重: 15%)</h3><div class="indicator-l3"><h5>机构及岗位设置 (权重: 45%)</h5><div class="score-option"><label><input type="radio" name="org_posts" value="1" required> <span>[1分] 仅设置了基础的网络安全岗位 (如安全管理员)。</span></label><label><input type="radio" name="org_posts" value="2"> <span>[2分] 配备了系统、网络、安全管理员等一定数量的安全岗位。</span></label><label><input type="radio" name="org_posts" value="3"> <span>[3分] 已构建完善的网络安全组织体系，有独立的网信安全管理职能部门，并成立了网信安全领导小组。</span></label><label><input type="radio" name="org_posts" value="4"> <span>[4分] 已构建多部门协同的网信安全组织体系 (包括与法务、人资、市场等协同)。</span></label><label><input type="radio" name="org_posts" value="5"> <span>[5分] 已塑造全球领先的网络安全组织机构，设立了前沿技术研究实验室、安全运营中心(SOC)等。</span></label></div></div><div class="indicator-l3"><h5>安全职责分配 (权重: 55%)</h5><div class="score-option"><label><input type="radio" name="org_resp" value="1" required> <span>[1分] 仅确定了网络安全相关岗位的基本职责。</span></label><label><input type="radio" name="org_resp" value="2"> <span>[2分] 已建立网络安全岗位分工协作机制，界定了关键岗位的安全职责。</span></label><label><input type="radio" name="org_resp" value="3"> <span>[3分] 已构建全面的网络安全责任体系，划分了安全责任层级，各岗位职责清晰明确。</span></label><label><input type="radio" name="org_resp" value="4"> <span>[4分] 已构建全面且深入的跨部门网络安全职责体系 (涵盖战略规划、资源调配、应急联动等多维度协同)。</span></label><label><input type="radio" name="org_resp" value="5"> <span>[5分] 已建立基于网络安全生态的责任共担与利益共享机制，引领行业职责规范。</span></label></div></div></div>
        <div class="assessment-section"><h3 class="indicator-l2">二、安全规划 (权重: 20%)</h3><div class="indicator-l3"><h5>规划编制 (权重: 40%)</h5><div class="score-option"><label><input type="radio" name="plan_dev" value="1" required> <span>[1分] 基于现有环境和业务需求，编制了年度网信安全战略目标。</span></label><label><input type="radio" name="plan_dev" value="2"> <span>[2分] 结合行业风险和趋势，编制了短期(1-2年)安全战略规划，包含具体任务。</span></label><label><input type="radio" name="plan_dev" value="3"> <span>[3分] 编制了全面且具前瞻性的(3-5年)安全战略规划，有明确阶段目标和执行计划。</span></label><label><input type="radio" name="plan_dev" value="4"> <span>[4分] 已编制形成全面的安全战略规划体系 (含长/中/短期)，关键领域有详细规划。</span></label><label><input type="radio" name="plan_dev" value="5"> <span>[5分] 对标全球战略格局和行业路径，形成系统性规划体系，并有定期评估与更新机制。</span></label></div></div><div class="indicator-l3"><h5>规划执行 (权重: 60%)</h5><div class="score-option"><label><input type="radio" name="plan_exec" value="1" required> <span>[1分] 初步建立了网络安全规划的执行方法。</span></label><label><input type="radio" name="plan_exec" value="2"> <span>[2分] 具备规划任务执行流程，并建立了定期的执行监督机制。</span></label><label><input type="radio" name="plan_exec" value="3"> <span>[3分] 已建立全面的规划执行体系，定期组织审定规划执行情况。</span></label><label><input type="radio" name="plan_exec" value="4"> <span>[4分] 已构建成熟的规划执行模式，各部门协同推进规划落地。</span></label><label><input type="radio" name="plan_exec" value="5"> <span>[5分] 全面执行规划，定期开展全面评估(含内外部专家参与)，跟踪任务有效性。</span></label></div></div></div>
        <div class="assessment-section"><h3 class="indicator-l2">三、监督问责 (权重: 15%)</h3><div class="indicator-l3"><h5>监督机制 (权重: 40%)</h5><div class="score-option"><label><input type="radio" name="sup_mech" value="1" required> <span>[1分] 建立了内部监督小组，制定了基本的网络安全监督流程。</span></label><label><input type="radio" name="sup_mech" value="2"> <span>[2分] 构建了全面的监督体系，制定了详细的监督计划 (含内容、范围、方法)。</span></label><label><input type="radio" name="sup_mech" value="3"> <span>[3分] 构建了覆盖跨部门网络安全工作的监督体系，并运用自动化工具进行监督。</span></label><label><input type="radio" name="sup_mech" value="4"> <span>[4分] 构建了多维度的网络安全架构监督体系，并定期对监督机制进行评估和优化。</span></label><label><input type="radio" name="sup_mech" value="5"> <span>[5分] 制定了智能化的监督规范与指标体系，有专业监督团队，定期评估优化并跟踪效果。</span></label></div></div><div class="indicator-l3"><h5>问题改进 (权重: 60%)</h5><div class="score-option"><label><input type="radio" name="sup_impr" value="1" required> <span>[1分] 初步收集监督问题，形成分析报告，制定基础改进目标。</span></label><label><input type="radio" name="sup_impr" value="2"> <span>[2分] 针对常见问题制定改进方案和计划 (含责任人、时间点)，跟踪并评估效果。</span></label><label><input type="radio" name="sup_impr" value="3"> <span>[3分] 针对各类问题 (含复杂/长期问题) 制定全面改进方案和具体改进流程。</span></label><label><input type="radio" name="sup_impr" value="4"> <span>[4分] 利用自动化技术改进，建立定期评估机制，多部门共享经验。</span></label><label><input type="radio" name="sup_impr" value="5"> <span>[5分] 改进经验形成知识库，建立长期跟踪机制，持续监测改进后状态。</span></label></div></div></div>
        <div class="assessment-section"><h3 class="indicator-l2">四、风险管理 (权重: 25%)</h3><div class="indicator-l3"><h5>策略与计划 (权重: 15%)</h5><div class="score-option"><label><input type="radio" name="risk_strat" value="1" required> <span>[1分] 针对关键资产明确了基本风险防范目标和策略，制定了风险管理计划。</span></label><label><input type="radio" name="risk_strat" value="2"> <span>[2分] 明确了风险优先级排序方法，编制了涵盖多业务场景的策略与计划。</span></label><label><input type="radio" name="risk_strat" value="3"> <span>[3分] 构建了全面且动态的风险管理策略体系，结合公司战略和业务变革更新计划。</span></label><label><input type="radio" name="risk_strat" value="4"> <span>[4分] 建立了跨部门风险管理协调机制，制定了详细的风险转移/规避/接受准则。</span></label><label><input type="radio" name="risk_strat" value="5"> <span>[5分] 建立了前瞻性风险管理战略，布局新兴技术风险应对，持续关注最新方法论。</span></label></div></div><div class="indicator-l3"><h5>风险识别 (权重: 35%)</h5><div class="score-option"><label><input type="radio" name="risk_ident" value="1" required> <span>[1分] 通过人工巡检和基础工具识别常见风险，有风险清单并定期更新。</span></label><label><input type="radio" name="risk_ident" value="2"> <span>[2分] 建立了结构化的风险识别方法，识别来自人员、环境等威胁，使用标准化问卷/检查表。</span></label><label><input type="radio" name="risk_ident" value="3"> <span>[3分] 风险识别范围覆盖业务关联的网络/系统/外部组织，并采用自动化工具辅助。</span></label><label><input type="radio" name="risk_ident" value="4"> <span>[4分] 运用多种安全检测工具/技术识别风险，周期性开展并维护清单。</span></label><label><input type="radio" name="risk_ident" value="5"> <span>[5分] 借助AI/大数据分析识别风险，将前沿技术未知风险纳入范围，构建风险知识图谱。</span></label></div></div><div class="indicator-l3"><h5>风险分析 (权重: 25%)</h5><div class="score-option"><label><input type="radio" name="risk_anal" value="1" required> <span>[1分] 对已识别风险分类描述，采用定性方法评估可能性和影响。</span></label><label><input type="radio" name="risk_anal" value="2"> <span>[2分] 结合定量分析手段，为风险赋予数值化评级或建立风险矩阵。</span></label><label><input type="radio" name="risk_anal" value="3"> <span>[3分] 能同时使用定性和定量方法评估风险的可能性和影响 (含严重性/频率)。</span></label><label><input type="radio" name="risk_anal" value="4"> <span>[4分] 运用专业风险分析模型，综合考虑多因素(业务连续性/声誉)，分析风险耦合/传播路径。</span></label><label><input type="radio" name="risk_anal" value="5"> <span>[5分] 利用AI/机器学习进行风险预测，实时监控变化，深入分析复杂性和相互依赖性。</span></label></div></div><div class="indicator-l3"><h5>风险响应 (权重: 25%)</h5><div class="score-option"><label><input type="radio" name="risk_resp" value="1" required> <span>[1分] 制定了基本的风险响应计划和高风险事件应急操作手册。</span></label><label><input type="radio" name="risk_resp" value="2"> <span>[2分] 能针对不同类型/级别风险制定具体响应策略 (含技术/操作程序)。</span></label><label><input type="radio" name="risk_resp" value="3"> <span>[3分] 建立了多类型风险响应预案库，能按等级/类型启动预案，实施跨部门协作响应。</span></label><label><input type="radio" name="risk_resp" value="4"> <span>[4分] 构建了综合(技术/管理/业务)风险响应体系，协调资源实施缓解/转移/接受，动态调整计划。</span></label><label><input type="radio" name="risk_resp" value="5"> <span>[5分] 实现了风险响应的自动化和智能化 (如利用AI/ML预测风险并自动执行)。</span></label></div></div></div>
        <div class="assessment-section"><h3 class="indicator-l2">五、安全检查 (权重: 15%)</h3><div class="indicator-l3"><h5>检查机制 (权重: 40%)</h5><div class="score-option"><label><input type="radio" name="check_mech" value="1" required> <span>[1分] 确立了人工为主的周期性基础检查机制，有简单巡检和记录。</span></label><label><input type="radio" name="check_mech" value="2"> <span>[2分] 构建了半自动化检查机制，用基础工具定期形成报告并标注风险。</span></label><label><input type="radio" name="check_mech" value="3"> <span>[3分] 建立了自动化与人工结合的全面检查机制，依据行业标准评估风险，实现多部门协同检查。</span></label><label><input type="radio" name="check_mech" value="4"> <span>[4分] 构建了多层次安全检查体系 (定期全面/不定期专项/重点实时监测)，整合多种工具。</span></label><label><input type="radio" name="check_mech" value="5"> <span>[5分] 对标国际权威标准，建设了智能化的网络安全检查系统平台。</span></label></div></div><div class="indicator-l3"><h5>问题整改 (权重: 60%)</h5><div class="score-option"><label><input type="radio" name="check_fix" value="1" required> <span>[1分] 针对检查发现的高风险问题，明确整改时间和手段。</span></label><label><input type="radio" name="check_fix" value="2"> <span>[2分] 制定整改方案，规定详细的整改步骤和计划。</span></label><label><input type="radio" name="check_fix" value="3"> <span>[3分] 整改计划全面覆盖各类风险问题 (低/中/高)，建立了可操作的整改流程。</span></label><label><input type="radio" name="check_fix" value="4"> <span>[4分] 引入先进技术/工具辅助整改，基于风险/业务影响排定优先级，有长期效果跟踪机制。</span></label><label><input type="radio" name="check_fix" value="5"> <span>[5分] 构建了智能化整改管理系统 (自动生成计划/分配资源/跟踪)，有跨部门/领域协同机制。</span></label></div></div></div>
        <div class="assessment-section"><h3 class="indicator-l2">六、资源投入 (权重: 10%)</h3><div class="indicator-l3"><h5>资源保障 (权重: 45%)</h5><div class="score-option"><label><input type="radio" name="res_gua" value="1" required> <span>[1分] 明确了基本资源保障范围，设立了专项网络安全预算。</span></label><label><input type="radio" name="res_gua" value="2"> <span>[2分] 明确了详细资源保障内容 (硬/软/人)，制定措施确保资源到位。</span></label><label><input type="radio" name="res_gua" value="3"> <span>[3分] 全面规划了资源保障体系 (含应急/冗余)，制定年度预算，定期盘点并监督到位。</span></label><label><input type="radio" name="res_gua" value="4"> <span>[4分] 构建了多层次资源保障架构，预算动态调整，有全面调配规则和风险评估机制。</span></label><label><input type="radio" name="res_gua" value="5"> <span>[5分] 建立了智能化资源保障生态系统 (如AI监控/调配)，有资源优化和共享机制。</span></label></div></div><div class="indicator-l3"><h5>资源分配 (权重: 55%)</h5><div class="score-option"><label><input type="radio" name="res_alloc" value="1" required> <span>[1分] 确定了网络安全资源分配的主要方向和计划。</span></label><label><input type="radio" name="res_alloc" value="2"> <span>[2分] 依据规划等要求细分了资源分配方向，明确了分配方式和手段。</span></label><label><input type="radio" name="res_alloc" value="3"> <span>[3分] 综合考虑业务/威胁/合规，全面规划了分配方案，建立了动态调整机制。</span></label><label><input type="radio" name="res_alloc" value="4"> <span>[4分] 建立了资源自动化分配模型，定期(如半年)评估分配效果。</span></label><label><input type="radio" name="res_alloc" value="5"> <span>[5分] 利用高级分析/模拟预判需求调整预算，有自动化的跨部门分配手段。</span></label></div></div></div>

        <div style="text-align: center; margin-top: 30px;">
            <button type="button" id="calculateBtn" onclick="calculateScore()">计算得分</button>
            <button type="button" id="generateTextReportBtn" style="display: none;" onclick="generateTextReport()">生成评估报告 (文本版)</button>
            <button type="button" id="generateWordReportBtn" style="display: none;" onclick="generateWordReport()">下载评估报告 (Word)</button>
            <button type="button" id="generateExcelBtn" style="display: none;" onclick="generateExcelReport()">下载为Excel (.xlsx)</button>
            <button type="button" id="aiReportBtn" onclick="window.open('https://cloud.fastgpt.cn/chat/share?shareId=ertgu0vnudcn8m27ipkjnkgn', '_blank');">AI报告编写</button>
        </div>
    </form>

    <div id="results">
        <h2>评估结果</h2>
        <div id="scores"><p>请先完成所有评估项的选择，然后点击计算按钮。</p></div>
        <div id="calculationDetails" style="display: none;"><h4>计算过程:</h4><div id="calculationContent"></div></div>
        <div id="chartRow">
            <div id="barChartContainer"><canvas id="barChart"></canvas></div>
            <div id="radarChartContainer"><canvas id="radarChart"></canvas></div>
        </div>
        <div id="aiAnalysisSection" style="display: none;"><h3><i class="fas fa-brain" style="margin-right: 8px;"></i>AI 智能分析与建议</h3><div id="aiAnalysisContent"><p>正在生成分析结果...</p></div></div>
        <div id="textReportContainer" style="display: none;"><h3><i class="fas fa-file-alt" style="margin-right: 8px;"></i>生成的文本报告</h3><p>您可以复制下面的报告文本。</p><textarea id="textReportOutput" rows="25" readonly></textarea></div>
        <div class="notes"><p><strong>注：</strong></p><ul><li>二级指标得分范围为 1-5 分，三级指标为其贡献原始得分（1-5分）。</li><li>安全统筹域总得分范围为 1-5 分。</li><li>上方“指标得分详情”展示了二级指标的最终得分和其对应的三级指标原始得分及权重。</li><li>“计算过程”部分展示了得分的详细推导过程。</li><li>图表区用柱状图（左）和雷达图（右）展示了二级指标的最终得分 (图表高度已设为一致)。</li><li>下方提供了基于评估结果的 AI 智能分析与建议 (模拟)。</li><li>点击“生成评估报告 (文本版)”可在页面下方生成可复制的纯文本报告。</li><li>点击“下载评估报告 (Word)”可生成包含文本和图表的 .doc 文件。</li><li>点击“下载为Excel (.xlsx)”可生成包含详细得分数据的 Excel 文件。</li><li>点击“AI报告编写”可在新标签页打开 FastGPT 链接。</li></ul></div>
    </div>

    <script>
        // --- Data Model (使用新的权重) ---
        const assessmentData = {
            domainName: "安全统筹", domainWeight: 0.20,
            indicatorsL2: [
                { name: "机构设置", weight: 0.15, indicatorsL3: [ { id: "org_posts", name: "机构及岗位设置", weight: 0.45 }, { id: "org_resp", name: "安全职责分配", weight: 0.55 } ]},
                { name: "安全规划", weight: 0.20, indicatorsL3: [ { id: "plan_dev", name: "规划编制", weight: 0.40 }, { id: "plan_exec", name: "规划执行", weight: 0.60 } ]},
                { name: "监督问责", weight: 0.15, indicatorsL3: [ { id: "sup_mech", name: "监督机制", weight: 0.40 }, { id: "sup_impr", name: "问题改进", weight: 0.60 } ]},
                { name: "风险管理", weight: 0.25, indicatorsL3: [ { id: "risk_strat", name: "策略与计划", weight: 0.15 }, { id: "risk_ident", name: "风险识别", weight: 0.35 }, { id: "risk_anal", name: "风险分析", weight: 0.25 }, { id: "risk_resp", name: "风险响应", weight: 0.25 } ]},
                { name: "安全检查", weight: 0.15, indicatorsL3: [ { id: "check_mech", name: "检查机制", weight: 0.40 }, { id: "check_fix", name: "问题整改", weight: 0.60 } ]},
                { name: "资源投入", weight: 0.10, indicatorsL3: [ { id: "res_gua", name: "资源保障", weight: 0.45 }, { id: "res_alloc", name: "资源分配", weight: 0.55 } ]}
            ]
        };

        // --- Global Variables ---
        let radarChartInstance = null; let barChartInstance = null; let reportData = null; let calculationSteps = "";

        // --- Calculation Logic ---
        function calculateScore() {
            let domainTotalScore = 0; const labelsL2 = []; const dataL2 = [];
            const detailedReportData = { domainName: assessmentData.domainName, assessmentTime: new Date().toLocaleString('zh-CN', { hour12: false }), l2Results: [], overallScore: 0 };
            calculationSteps = "计算过程分解:\n\n"; let allSelected = true;
            assessmentData.indicatorsL2.forEach(indicatorL2 => {
                let scoreL2 = 0; let l2CalcString = `${indicatorL2.name} 得分 = `; const l3ResultsForReport = []; let l3CalcParts = [];
                indicatorL2.indicatorsL3.forEach(indicatorL3 => {
                    const selectedRadio = document.querySelector(`input[name="${indicatorL3.id}"]:checked`);
                    if (selectedRadio) {
                        const scoreL3 = parseFloat(selectedRadio.value); const descriptionL3 = selectedRadio.nextElementSibling.textContent.trim();
                        scoreL2 += scoreL3 * indicatorL3.weight; l3CalcParts.push(`(${scoreL3} * ${indicatorL3.weight.toFixed(2)})`);
                        l3ResultsForReport.push({ name: indicatorL3.name, score: scoreL3, description: descriptionL3 });
                    } else { allSelected = false; }
                });
                l2CalcString += l3CalcParts.join(' + ') + ` = ${scoreL2.toFixed(2)}`; calculationSteps += l2CalcString + "\n";
                labelsL2.push(indicatorL2.name); dataL2.push(scoreL2.toFixed(2));
                detailedReportData.l2Results.push({ name: indicatorL2.name, score: scoreL2.toFixed(2), weight: indicatorL2.weight, l3Details: l3ResultsForReport });
            });
            let domainCalcString = `${assessmentData.domainName}域总分 = `; let domainCalcParts = [];
            detailedReportData.l2Results.forEach(l2 => { domainTotalScore += parseFloat(l2.score) * l2.weight; domainCalcParts.push(`(${l2.score} * ${l2.weight.toFixed(2)})`); });
            domainCalcString += domainCalcParts.join(' + ') + ` = ${domainTotalScore.toFixed(2)}`; calculationSteps += "\n" + domainCalcString + "\n";
            const resultsScoresDiv = document.getElementById('scores'); const calculationDiv = document.getElementById('calculationContent');
            const calculationContainer = document.getElementById('calculationDetails'); const generateTextReportBtn = document.getElementById('generateTextReportBtn');
            const generateWordReportBtn = document.getElementById('generateWordReportBtn'); const generateExcelBtn = document.getElementById('generateExcelBtn');
            const aiAnalysisSection = document.getElementById('aiAnalysisSection'); const aiAnalysisContent = document.getElementById('aiAnalysisContent');
            const textReportContainer = document.getElementById('textReportContainer'); const textReportOutput = document.getElementById('textReportOutput');
            if (!allSelected) {
                 resultsScoresDiv.innerHTML = "<p style='color: red; font-weight: bold; text-align: center;'>错误：请确保所有评估项都已选择！</p>"; calculationContainer.style.display = 'none';
                 aiAnalysisSection.style.display = 'none'; aiAnalysisContent.innerHTML = '<p>请先完成评估并计算得分。</p>'; textReportContainer.style.display = 'none';
                 textReportOutput.value = ''; if (radarChartInstance) { radarChartInstance.destroy(); radarChartInstance = null; } if (barChartInstance) { barChartInstance.destroy(); barChartInstance = null; }
                 generateTextReportBtn.style.display = 'none'; generateWordReportBtn.style.display = 'none'; generateExcelBtn.style.display = 'none'; reportData = null; return;
            }
            detailedReportData.overallScore = domainTotalScore.toFixed(2); reportData = detailedReportData;
            let resultsHTML = `<h4>指标得分详情:</h4>`;
            detailedReportData.l2Results.forEach(l2 => {
                resultsHTML += `<div class="l2-score-item"><h5>${l2.name} (二级指标得分): ${l2.score}</h5>`;
                if (l2.l3Details && l2.l3Details.length > 0) {
                    resultsHTML += `<ul class="l3-score-list">`; const l2Def = assessmentData.indicatorsL2.find(item => item.name === l2.name);
                    l2.l3Details.forEach(l3 => {
                        const l3Def = l2Def?.indicatorsL3.find(item => item.name === l3.name); const l3WeightText = l3Def ? ` (权重: ${(l3Def.weight * 100).toFixed(0)}%)` : "";
                        resultsHTML += `<li>${l3.name} (原始得分): ${l3.score}${l3WeightText}</li>`;
                    }); resultsHTML += `</ul>`;
                } resultsHTML += `</div>`;
            });
            resultsHTML += `<hr><h4>${assessmentData.domainName}域总得分: ${detailedReportData.overallScore} / 5.00</h4>`; resultsScoresDiv.innerHTML = resultsHTML;
            calculationDiv.textContent = calculationSteps; calculationContainer.style.display = 'block';
            updateRadarChart(labelsL2, dataL2); updateBarChart(labelsL2, dataL2);
            const analysisHTML = generateAIAnalysis(reportData, 'html'); aiAnalysisContent.innerHTML = analysisHTML; aiAnalysisSection.style.display = 'block';
            generateTextReportBtn.style.display = 'inline-block'; generateWordReportBtn.style.display = 'inline-block'; generateExcelBtn.style.display = 'inline-block';
            textReportContainer.style.display = 'none'; textReportOutput.value = '';
        }

        // --- Visualization Logic: Radar Chart ---
        function updateRadarChart(labels, data) {
            const ctx = document.getElementById('radarChart').getContext('2d'); if (radarChartInstance) { radarChartInstance.destroy(); }
            const radarLineColor = '#005BAC'; const radarFillColor = 'rgba(70, 130, 180, 0.3)'; const radarPointColor = '#003366';
            const radarPointStrokeColor = '#FFFFFF'; const radarPointHighlightFill = '#87CEEB'; const radarPointHighlightStroke = radarPointColor;
            radarChartInstance = new Chart(ctx, {
                type: 'radar', data: { labels: labels, datasets: [{ label: `二级指标得分 (雷达图)`, data: data, fill: true, backgroundColor: radarFillColor, borderColor: radarLineColor, pointBackgroundColor: radarPointColor, pointBorderColor: radarPointStrokeColor, pointHoverBackgroundColor: radarPointHighlightFill, pointHoverBorderColor: radarPointHighlightStroke, pointRadius: 4, pointHoverRadius: 6, borderWidth: 2.5, tension: 0.1 }] },
                options: { responsive: true, maintainAspectRatio: false, elements: { line: {} }, scales: { r: { min: 0, max: 5, ticks: { stepSize: 1, backdropColor: 'rgba(255, 255, 255, 0.6)', color: '#444', font: { size: 11 } }, pointLabels: { font: { size: 13, weight: '500' }, color: '#333' }, angleLines: { color: 'rgba(0, 0, 0, 0.1)' }, grid: { color: 'rgba(0, 0, 0, 0.1)' } } }, plugins: { legend: { position: 'top', labels: { padding: 10, font: {size: 13} } }, tooltip: { backgroundColor: 'rgba(0, 0, 0, 0.75)', titleFont: { weight: 'bold' }, bodyFont: { size: 13 }, padding: 10, callbacks: { label: context => `${context.label}: ${context.parsed.r.toFixed(2)}` } } } }
            });
        }

        // --- Visualization Logic: Bar Chart ---
        function updateBarChart(labels, data) {
            const ctx = document.getElementById('barChart').getContext('2d'); if (barChartInstance) { barChartInstance.destroy(); }
             const barBgColor = 'rgba(95, 158, 160, 0.6)'; const barBorderColor = 'rgb(70, 130, 180)'; const barHoverBgColor = 'rgba(70, 130, 180, 0.8)'; const barHoverBorderColor = 'rgb(0, 51, 102)';
            barChartInstance = new Chart(ctx, {
                type: 'bar', data: { labels: labels, datasets: [{ label: `二级指标得分 (柱状图)`, data: data, backgroundColor: barBgColor, borderColor: barBorderColor, borderWidth: 1, hoverBackgroundColor: barHoverBgColor, hoverBorderColor: barHoverBorderColor, barPercentage: 0.7, categoryPercentage: 0.8 }] },
                options: { responsive: true, maintainAspectRatio: false, indexAxis: 'x', scales: { y: { beginAtZero: true, min: 0, max: 5, title: { display: true, text: '得分', font: {size: 13} }, ticks: { color: '#444' } }, x: { title: { display: false }, ticks: { font: { size: 13 }, color: '#444' } } }, plugins: { legend: { display: true, position: 'top', labels: { padding: 10, font: {size: 13} } }, tooltip: { backgroundColor: 'rgba(0, 0, 0, 0.75)', titleFont: { weight: 'bold' }, bodyFont: { size: 13 }, padding: 10, callbacks: { label: context => `${context.label}: ${context.parsed.y.toFixed(2)}` } } } }
            });
        }

        // --- AI Analysis Generation ---
        function generateAIAnalysis(reportData, format = 'html') {
             let analysisOutput = ""; const overallScore = parseFloat(reportData.overallScore); let overallLevel = ""; let overallSummary = "";
             let strengths = []; let weaknesses = []; const LOW_THRESHOLD = 2.5; const HIGH_THRESHOLD = 4.0; const newLine = format === 'text' ? '\n' : '<br>';
             const headingStart = format === 'text' ? '### ' : '<h5>'; const headingEnd = format === 'text' ? ' ###' + newLine : '</h5>'; const listStart = format === 'text' ? '' : '<ul>';
             const listEnd = format === 'text' ? '' : '</ul>'; const itemStart = format === 'text' ? '- ' : '<li>'; const itemEnd = format === 'text' ? newLine : '</li>';
             const boldStart = format === 'text' ? '**' : '<strong>'; const boldEnd = format === 'text' ? '**' : '</strong>';
             let levelText = ""; if (overallScore < LOW_THRESHOLD) levelText = "基础水平"; else if (overallScore < HIGH_THRESHOLD) levelText = "发展中水平"; else levelText = "良好水平";
             overallLevel = format === 'html' ? (overallScore < LOW_THRESHOLD ? `<span class='low-score'>${levelText}</span>` : (overallScore < HIGH_THRESHOLD ? `<span class='medium-score'>${levelText}</span>` : `<span class='high-score'>${levelText}</span>`)) : levelText;
             if (overallScore < LOW_THRESHOLD) overallSummary = `当前安全统筹能力处于基础阶段，存在较多明显的改进空间。建议优先关注得分低于 ${LOW_THRESHOLD} 分的领域，制定并落实改进计划。`;
             else if (overallScore < HIGH_THRESHOLD) overallSummary = `安全统筹能力处于发展阶段，已具备一定的基础，但在多个方面仍有提升潜力。建议持续优化现有机制，特别关注得分低于 ${HIGH_THRESHOLD} 分的领域，并留意新兴风险。`;
             else overallSummary = `安全统筹能力表现良好，多数领域已建立较成熟的机制。建议保持现有优势，并探索更前沿的安全技术与管理方法，确保持续领先。`;
             analysisOutput += `${headingStart}总体评价:${headingEnd}`; analysisOutput += (format === 'html' ? '<p>' : '') + `根据评估结果，您在 ${boldStart}${reportData.domainName}${boldEnd} 域的总体得分为 ${boldStart}${overallScore.toFixed(2)}${boldEnd} (满分 5.00)，处于 ${overallLevel}。` + (format === 'html' ? '</p>' : newLine);
             analysisOutput += (format === 'html' ? '<p>' : '') + overallSummary + (format === 'html' ? '</p>' : (newLine + newLine));
             analysisOutput += `${headingStart}各指标分析与建议:${headingEnd}${listStart}`;
             reportData.l2Results.forEach(l2 => {
                 const score = parseFloat(l2.score); let indicatorStatus = ""; let suggestion = ""; let statusText = "";
                 if (score < LOW_THRESHOLD) { weaknesses.push(l2.name); statusText = "有待加强"; indicatorStatus = format === 'html' ? `<span class='low-score'>${statusText}</span>` : `(${statusText})`;
                     if (l2.name === "机构设置") suggestion = "加强组织建设，明确岗位职责和跨部门协作机制，确保有独立的管理职能。"; else if (l2.name === "安全规划") suggestion = "制定更全面、具体的安全战略规划（至少覆盖1-2年），明确目标和执行计划，并确保有效监督执行。"; else if (l2.name === "监督问责") suggestion = "建立完善的内部监督流程和问题改进闭环机制，明确问责制度，可考虑引入自动化工具辅助监督。"; else if (l2.name === "风险管理") suggestion = "系统性地开展风险识别、分析和响应工作，建立结构化方法和策略，明确风险处置流程。"; else if (l2.name === "安全检查") suggestion = "提高检查的频率和深度（如引入半自动化工具），建立有效的整改跟踪机制，确保问题闭环。"; else if (l2.name === "资源投入") suggestion = "保障充足且明确的安全预算和人力资源，并根据风险和规划进行合理分配。"; else suggestion = "需重点关注并投入资源进行改进，参考评分标准中的2-3分项要求。";
                 } else if (score < HIGH_THRESHOLD) { statusText = "存在提升空间"; indicatorStatus = format === 'html' ? `<span class='medium-score'>${statusText}</span>` : `(${statusText})`;
                     if (l2.name === "机构设置") suggestion = "优化现有组织结构，深化跨部门协同，考虑建立网信安全领导小组。"; else if (l2.name === "安全规划") suggestion = "定期审视和更新规划（如制定3-5年规划），提升规划的前瞻性和执行评估的有效性。"; else if (l2.name === "监督问责") suggestion = "提升监督效率（如引入自动化工具）和问题改进的有效性，推广成功经验，形成知识库。"; else if (l2.name === "风险管理") suggestion = "深化风险分析能力（结合定量分析），优化风险响应预案库，加强跨部门协作响应。"; else if (l2.name === "安全检查") suggestion = "探索更智能化的检查手段（自动化与人工结合），基于风险优化整改优先级，加强效果跟踪。"; else if (l2.name === "资源投入") suggestion = "优化资源分配模型，建立动态调整机制，提升资源使用效益。"; else suggestion = "持续改进，参考评分标准中的4分项要求进行优化。";
                 } else { strengths.push(l2.name); statusText = "表现良好"; indicatorStatus = format === 'html' ? `<span class='high-score'>${statusText}</span>` : `(${statusText})`;
                     if (l2.name === "机构设置") suggestion = "保持领先，关注组织效率和对新业务的适应性，探索设立SOC等高级机构。"; else if (l2.name === "安全规划") suggestion = "保持规划的前瞻性，对标全球和行业趋势，建立定期评估更新机制。"; else if (l2.name === "监督问责") suggestion = "分享最佳实践，持续优化智能化监督指标体系和专业团队能力。"; else if (l2.name === "风险管理") suggestion = "探索基于AI/大数据的风险预测和自动化响应，关注新兴技术风险。"; else if (l2.name === "安全检查") suggestion = "保持高标准检查（对标国际标准），关注检查体系的智能化和持续优化。"; else if (l2.name === "资源投入") suggestion = "保持投入，探索智能化资源监控调配和优化共享机制。"; else suggestion = "保持并巩固现有成果，可作为其他领域的标杆。";
                 }
                 analysisOutput += `${itemStart}${boldStart}${l2.name}${boldEnd} (得分: ${score.toFixed(2)})：${indicatorStatus}。${boldStart}建议：${boldEnd}${suggestion}${itemEnd}`;
             }); analysisOutput += listEnd;
             analysisOutput += `${headingStart}关键点总结:${headingEnd}`;
             if (strengths.length > 0) analysisOutput += (format === 'html' ? '<p>' : '') + `${boldStart}主要优势领域：${boldEnd} ${strengths.join('、')}。这些领域表现突出，请继续保持和发扬。` + (format === 'html' ? '</p>' : newLine); else analysisOutput += (format === 'html' ? '<p>' : '') + `${boldStart}主要优势领域：${boldEnd} 暂无得分达到 ${HIGH_THRESHOLD} 分以上的明显优势项，各方面均有提升空间。` + (format === 'html' ? '</p>' : newLine);
             if (weaknesses.length > 0) analysisOutput += (format === 'html' ? '<p>' : '') + `${boldStart}主要改进领域：${boldEnd} ${weaknesses.join('、')}。这些领域得分低于 ${LOW_THRESHOLD} 分，是当前的短板，建议优先投入资源进行改进。` + (format === 'html' ? '</p>' : (newLine + newLine)); else if (overallScore < HIGH_THRESHOLD) analysisOutput += (format === 'html' ? '<p>' : '') + `${boldStart}主要改进领域：${boldEnd} 各项指标得分相对均衡，无特别突出的薄弱环节（得分低于 ${LOW_THRESHOLD} 分），建议根据业务优先级，针对性地对得分未达 ${HIGH_THRESHOLD} 分的领域进行持续优化。` + (format === 'html' ? '</p>' : (newLine + newLine)); else analysisOutput += (format === 'html' ? '<p>' : '') + `${boldStart}主要改进领域：${boldEnd} 各项指标均表现良好，建议在保持现有水平的基础上，关注前沿技术和管理方法的应用，持续提升。` + (format === 'html' ? '</p>' : (newLine + newLine));
             return analysisOutput;
        }

        // --- Generate Text Report (Cleaned Version) ---
        function generateTextReport() {
            if (!reportData) { alert("请先完成评估并点击“计算得分”按钮。"); return; }
            const textReportContainer = document.getElementById('textReportContainer'); const textReportOutput = document.getElementById('textReportOutput');
            let reportString = ""; const today = new Date(); const assessmentDate = today.toLocaleDateString('zh-CN', { year: 'numeric', month: 'long', day: 'numeric'});
            reportString += `========================================\n     安全统筹域评估报告 (文本版) \n========================================\n\n评估日期: ${assessmentDate}\n评估对象: [请填写评估对象]\n报告版本: 1.0\n\n`;
            reportString += `----------------------------------------\n          1. 执行摘要\n----------------------------------------\n`;
            const overallScore = parseFloat(reportData.overallScore); let overallLevelText = ""; if (overallScore < 2.5) overallLevelText = "基础水平"; else if (overallScore < 4.0) overallLevelText = "发展中水平"; else overallLevelText = "良好水平";
            let strengths = reportData.l2Results.filter(l2 => parseFloat(l2.score) >= 4.0).map(l2 => l2.name); let weaknesses = reportData.l2Results.filter(l2 => parseFloat(l2.score) < 2.5).map(l2 => l2.name);
            reportString += `本次安全统筹域评估总体得分为 ${reportData.overallScore} 分（满分 5.00 分），处于 "${overallLevelText}"。\n\n主要发现:\n`; if (strengths.length > 0) { reportString += `- 优势领域: ${strengths.join('、')} 得分相对较高。\n`; } else { reportString += `- 优势领域: 暂无得分达到4.0分以上的明显优势项。\n`; } if (weaknesses.length > 0) { reportString += `- 薄弱环节: ${weaknesses.join('、')} 得分显著偏低，是主要短板。\n`; } else { reportString += `- 薄弱环节: 各项得分相对均衡，无得分低于2.5分的显著短板。\n`; } reportString += `- 其他领域得分处于中等水平，均有不同程度的改进空间。\n\n核心建议:\n- 优先加强 ${weaknesses.length > 0 ? `"${weaknesses.join('", "')}"` : "得分相对较低的领域"} 的建设。\n- 巩固 ${strengths.length > 0 ? `"${strengths.join('", "')}"` : "得分相对较高的领域"} 的优势。\n- 全面审视和优化各项安全统筹管理活动。\n\n`;
            reportString += `----------------------------------------\n       2. 评估范围与方法\n----------------------------------------\n- 评估范围: 安全统筹域，包括机构设置、安全规划、监督问责、风险管理、安全检查、资源投入六个二级指标及其下属三级指标。\n- 评估方法: 基于预设框架进行自评估打分，依据权重计算各级指标得分。\n\n`;
            reportString += `----------------------------------------\n       3. 详细评估结果与分析\n----------------------------------------\n安全统筹域总体得分: ${reportData.overallScore} / 5.00\n\n各二级指标得分详情:\n`;
            reportData.l2Results.forEach(l2 => { reportString += `\n--- ${l2.name} (二级指标得分: ${l2.score}) ---\n`; const l2Def = assessmentData.indicatorsL2.find(item => item.name === l2.name); l2.l3Details.forEach(l3 => { const l3Def = l2Def?.indicatorsL3.find(item => item.name === l3.name); const l3WeightText = l3Def ? `(权重: ${(l3Def.weight * 100).toFixed(0)}%)` : ""; reportString += `  - ${l3.name} (原始得分: ${l3.score}) ${l3WeightText}\n`; }); });
            reportString += `\n----------------------------------------\n       4. 评估结果可视化 (描述)\n----------------------------------------\n- 柱状图和雷达图 (未包含在此文本报告中) 可直观展示各二级指标得分高低及能力均衡性。\n- 从得分看，${strengths.length > 0 ? `"${strengths.join('", "')}"` : "部分领域"}表现较好，而 ${weaknesses.length > 0 ? `"${weaknesses.join('", "')}"` : "部分领域"}有明显不足。\n`;
            reportString += `\n----------------------------------------\n       5. 智能分析与建议 (模拟)\n----------------------------------------\n${generateAIAnalysis(reportData, 'text')}`; // Correctly call AI analysis for text
            reportString += `\n----------------------------------------\n       6. 详细改进建议\n----------------------------------------\n`;
            let recommendationCount = 1; const highPrioritySuggestions_text = []; const mediumPrioritySuggestions_text = []; const lowPrioritySuggestions_text = [];
            reportData.l2Results.forEach(l2 => { const score = parseFloat(l2.score); let suggestion = ""; if (score < 2.5) { if (l2.name === "机构设置") suggestion = "加强组织建设，明确岗位职责和跨部门协作机制，确保有独立的管理职能。"; else if (l2.name === "安全规划") suggestion = "制定更全面、具体的安全战略规划（至少覆盖1-2年），明确目标和执行计划，并确保有效监督执行。"; else if (l2.name === "监督问责") suggestion = "建立完善的内部监督流程和问题改进闭环机制，明确问责制度，可考虑引入自动化工具辅助监督。"; else if (l2.name === "风险管理") suggestion = "系统性地开展风险识别、分析和响应工作，建立结构化方法和策略，明确风险处置流程。"; else if (l2.name === "安全检查") suggestion = "提高检查的频率和深度（如引入半自动化工具），建立有效的整改跟踪机制，确保问题闭环。"; else if (l2.name === "资源投入") suggestion = "保障充足且明确的安全预算和人力资源，并根据风险和规划进行合理分配。"; else suggestion = "投入资源进行重点改进。"; highPrioritySuggestions_text.push({ name: l2.name, suggestion: suggestion }); } else if (score < 4.0) { if (l2.name === "机构设置") suggestion = "优化现有组织结构，深化跨部门协同，考虑建立网信安全领导小组。"; else if (l2.name === "安全规划") suggestion = "定期审视和更新规划（如制定3-5年规划），提升规划的前瞻性和执行评估的有效性。"; else if (l2.name === "监督问责") suggestion = "提升监督效率（如引入自动化工具）和问题改进的有效性，推广成功经验，形成知识库。"; else if (l2.name === "风险管理") suggestion = "深化风险分析能力（结合定量分析），优化风险响应预案库，加强跨部门协作响应。"; else if (l2.name === "安全检查") suggestion = "探索更智能化的检查手段（自动化与人工结合），基于风险优化整改优先级，加强效果跟踪。"; else if (l2.name === "资源投入") suggestion = "优化资源分配模型，建立动态调整机制，提升资源使用效益。"; else suggestion = "持续改进，参考更高标准优化。"; mediumPrioritySuggestions_text.push({ name: l2.name, suggestion: suggestion }); } else { if (l2.name === "机构设置") suggestion = "关注组织效率和对新业务的适应性，探索设立SOC等高级机构。"; else if (l2.name === "安全规划") suggestion = "保持规划的前瞻性，关注新兴技术趋势。"; else if (l2.name === "监督问责") suggestion = "分享最佳实践，优化指标体系。"; else if (l2.name === "风险管理") suggestion = "探索AI/大数据应用。"; else if (l2.name === "安全检查") suggestion = "保持高标准，关注体系优化。"; else if (l2.name === "资源投入") suggestion = "保持投入，关注新技术方法。"; else suggestion = "保持并巩固成果。"; lowPrioritySuggestions_text.push({ name: l2.name, suggestion: suggestion }); } });
            if (highPrioritySuggestions_text.length > 0) { reportString += `【高优先级 - 针对薄弱环节】:\n`; highPrioritySuggestions_text.forEach(item => { reportString += `${recommendationCount++}. ${item.name}: ${item.suggestion}\n`; }); reportString += `\n`; }
            if (mediumPrioritySuggestions_text.length > 0) { reportString += `【中优先级 - 针对有提升空间的领域】:\n`; mediumPrioritySuggestions_text.forEach(item => { reportString += `${recommendationCount++}. ${item.name}: ${item.suggestion}\n`; }); reportString += `\n`; }
            if (lowPrioritySuggestions_text.length > 0) { reportString += `【持续保持 - 针对优势领域】:\n`; lowPrioritySuggestions_text.forEach(item => { reportString += `${recommendationCount++}. ${item.name}: ${item.suggestion}\n`; }); reportString += `\n`; }
            if(recommendationCount === 1){ reportString += "各项指标均表现出色，建议持续关注行业最佳实践和新兴威胁。\n\n"; }
            reportString += `----------------------------------------\n          7. 结语\n----------------------------------------\n建议根据本报告提出的改进建议，结合实际业务情况，制定详细的行动计划，并定期复评（如每年）以跟踪进展和效果。\n\n--- 报告结束 ---\n`;
            textReportOutput.value = reportString; textReportContainer.style.display = 'block'; textReportContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // --- Generate Word Report ---
        function generateWordReport() {
            // ... Word report generation function remains unchanged ...
            if (!reportData || !radarChartInstance || !barChartInstance) { alert("错误：无法生成Word报告。请先成功计算分数并确保图表已生成。"); return; }
            let barChartImgData = null; let radarChartImgData = null; try { barChartImgData = document.getElementById('barChart').toDataURL('image/png', 1.0); } catch(e) { console.error("Error getting Bar Chart image data for Word:", e); } try { radarChartImgData = document.getElementById('radarChart').toDataURL('image/png', 1.0); } catch(e) { console.error("Error getting Radar Chart image data for Word:", e); }
            const overallScore = parseFloat(reportData.overallScore); let overallLevelText = ""; if (overallScore < 2.5) overallLevelText = "基础水平"; else if (overallScore < 4.0) overallLevelText = "发展中水平"; else overallLevelText = "良好水平";
            let strengths = reportData.l2Results.filter(l2 => parseFloat(l2.score) >= 4.0).map(l2 => l2.name); let weaknesses = reportData.l2Results.filter(l2 => parseFloat(l2.score) < 2.5).map(l2 => l2.name);
            const today = new Date(); const assessmentDate = today.toLocaleDateString('zh-CN', { year: 'numeric', month: 'long', day: 'numeric'});
            let htmlContent = ` <!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>安全统筹域评估报告</title> <style> body { font-family: 'SimSun', '宋体', serif; line-height: 1.6; margin: 30px; } h1, h2, h3 { color: #005BAC; margin-bottom: 10px; } h1 { text-align: center; font-size: 22pt; } h2 { font-size: 16pt; border-bottom: 1px solid #ccc; padding-bottom: 5px; margin-top: 25px; } h3 { font-size: 14pt; color: #004a8c; margin-top: 20px; } p { margin-bottom: 10px; font-size: 11pt; } ul { list-style-type: disc; margin-left: 40px; } li { margin-bottom: 5px; font-size: 11pt;} .l2-item { margin-bottom: 15px; padding-left: 10px; border-left: 3px solid #a8c7e0; } .l3-list { list-style-type: circle; margin-left: 20px; font-size: 10pt; color: #333; } .l3-list li { margin-bottom: 3px; } .l3-desc { color: #555; font-style: italic; margin-left: 15px; } .chart-container { text-align: center; margin-top: 15px; margin-bottom: 15px; } .chart-container img { max-width: 48%; height: auto; margin: 0 1%; border: 1px solid #eee; vertical-align: top;} .ai-section h3 { text-align: center; } .ai-section h5 { font-size: 12pt; color: #005BAC; margin-top: 15px; border-bottom: 1px dotted #ccc; } .ai-section strong { font-weight: bold; color: #003366; } .low-score { color: #dc3545; font-weight: bold; } .medium-score { color: #ffc107; font-weight: bold; } .high-score { color: #28a745; font-weight: bold; } .recommendation-list { list-style-type: decimal; margin-left: 20px; } .recommendation-list li { margin-bottom: 8px; } .recommendation-list ul { list-style-type: disc; margin-left: 20px; } .priority-high { font-weight: bold; color: #a94442; } .priority-medium { font-weight: bold; color: #8a6d3b; } .priority-low { font-weight: bold; color: #3c763d; } hr { border: 0; border-top: 1px solid #ccc; margin: 25px 0; } </style></head><body> <h1>安全统筹域评估报告</h1><p><strong>评估日期:</strong> ${assessmentDate}</p><p><strong>评估对象:</strong> [请填写评估对象]</p><p><strong>报告版本:</strong> 1.0</p> <h2>1. 执行摘要</h2><p>本次安全统筹域评估总体得分为 <strong>${reportData.overallScore}</strong> 分（满分 5.00 分），处于 "<strong>${overallLevelText}</strong>"。</p><p><strong>主要发现:</strong></p><ul><li>优势领域: ${strengths.length > 0 ? strengths.join('、') + ' 得分相对较高。' : '暂无得分达到4.0分以上的明显优势项。'}</li><li>薄弱环节: ${weaknesses.length > 0 ? weaknesses.join('、') + ' 得分显著偏低，是主要短板。' : '各项得分相对均衡，无得分低于2.5分的显著短板。'}</li><li>其他领域得分处于中等水平，均有不同程度的改进空间。</li></ul><p><strong>核心建议:</strong></p><ul><li>优先加强 ${weaknesses.length > 0 ? `"${weaknesses.join('", "')}"` : "得分相对较低的领域"} 的建设。</li><li>巩固 ${strengths.length > 0 ? `"${strengths.join('", "')}"` : "得分相对较高的领域"} 的优势。</li><li>全面审视和优化各项安全统筹管理活动。</li></ul> <h2>2. 评估范围与方法</h2><p><strong>评估范围:</strong> 安全统筹域，包括机构设置、安全规划、监督问责、风险管理、安全检查、资源投入六个二级指标及其下属三级指标。</p><p><strong>评估方法:</strong> 基于预设框架进行自评估打分，依据权重计算各级指标得分。</p> <h2>3. 详细评估结果与分析</h2><p><strong>安全统筹域总体得分: ${reportData.overallScore} / 5.00</strong></p> `;
            reportData.l2Results.forEach(l2 => { htmlContent += `<div class="l2-item"><h3>- ${l2.name} (二级指标得分: ${l2.score})</h3>`; const l2Def = assessmentData.indicatorsL2.find(item => item.name === l2.name); if (l2.l3Details && l2.l3Details.length > 0) { htmlContent += `<ul class="l3-list">`; l2.l3Details.forEach(l3 => { const l3Def = l2Def?.indicatorsL3.find(item => item.name === l3.name); const l3WeightText = l3Def ? `(权重: ${(l3Def.weight * 100).toFixed(0)}%)` : ""; htmlContent += `<li><strong>${l3.name}</strong> (原始得分: ${l3.score}) ${l3WeightText}</li><li class="l3-desc">选择项: ${l3.description}</li>`; }); htmlContent += `</ul>`; } htmlContent += `</div>`; });
            htmlContent += ` <h2>4. 评估结果可视化</h2><div class="chart-container"> `; if (barChartImgData) { htmlContent += `<img src="${barChartImgData}" alt="柱状图">`; } else { htmlContent += `<p>未能生成柱状图</p>`; } if (radarChartImgData) { htmlContent += `<img src="${radarChartImgData}" alt="雷达图">`; } else { htmlContent += `<p>未能生成雷达图</p>`; } htmlContent += `</div> <hr><div class="ai-section"><h2>5. 智能分析与建议 (模拟)</h2>${generateAIAnalysis(reportData, 'html')}</div><hr> `; htmlContent += `<h2>6. 详细改进建议</h2><ol class="recommendation-list">`;
            let recommendationCount = 1; const highPrioritySuggestions = []; const mediumPrioritySuggestions = []; const lowPrioritySuggestions = [];
            reportData.l2Results.forEach(l2 => { const score = parseFloat(l2.score); let suggestion = ""; if (score < 2.5) { if (l2.name === "机构设置") suggestion = "加强组织建设，明确岗位职责和跨部门协作机制，确保有独立的管理职能。"; else if (l2.name === "安全规划") suggestion = "制定更全面、具体的安全战略规划（至少覆盖1-2年），明确目标和执行计划，并确保有效监督执行。"; else if (l2.name === "监督问责") suggestion = "建立完善的内部监督流程和问题改进闭环机制，明确问责制度，可考虑引入自动化工具辅助监督。"; else if (l2.name === "风险管理") suggestion = "系统性地开展风险识别、分析和响应工作，建立结构化方法和策略，明确风险处置流程。"; else if (l2.name === "安全检查") suggestion = "提高检查的频率和深度（如引入半自动化工具），建立有效的整改跟踪机制，确保问题闭环。"; else if (l2.name === "资源投入") suggestion = "保障充足且明确的安全预算和人力资源，并根据风险和规划进行合理分配。"; else suggestion = "投入资源进行重点改进。"; highPrioritySuggestions.push({ name: l2.name, suggestion: suggestion }); } else if (score < 4.0) { if (l2.name === "机构设置") suggestion = "优化现有组织结构，深化跨部门协同，考虑建立网信安全领导小组。"; else if (l2.name === "安全规划") suggestion = "定期审视和更新规划（如制定3-5年规划），提升规划的前瞻性和执行评估的有效性。"; else if (l2.name === "监督问责") suggestion = "提升监督效率（如引入自动化工具）和问题改进的有效性，推广成功经验，形成知识库。"; else if (l2.name === "风险管理") suggestion = "深化风险分析能力（结合定量分析），优化风险响应预案库，加强跨部门协作响应。"; else if (l2.name === "安全检查") suggestion = "探索更智能化的检查手段（自动化与人工结合），基于风险优化整改优先级，加强效果跟踪。"; else if (l2.name === "资源投入") suggestion = "优化资源分配模型，建立动态调整机制，提升资源使用效益。"; else suggestion = "持续改进，参考更高标准优化。"; mediumPrioritySuggestions.push({ name: l2.name, suggestion: suggestion }); } else { if (l2.name === "机构设置") suggestion = "关注组织效率和对新业务的适应性，探索设立SOC等高级机构。"; else if (l2.name === "安全规划") suggestion = "保持规划的前瞻性，关注新兴技术趋势。"; else if (l2.name === "监督问责") suggestion = "分享最佳实践，优化指标体系。"; else if (l2.name === "风险管理") suggestion = "探索AI/大数据应用。"; else if (l2.name === "安全检查") suggestion = "保持高标准，关注体系优化。"; else if (l2.name === "资源投入") suggestion = "保持投入，关注新技术方法。"; else suggestion = "保持并巩固成果。"; lowPrioritySuggestions.push({ name: l2.name, suggestion: suggestion }); } });
            if (highPrioritySuggestions.length > 0) { htmlContent += `<li><strong class="priority-high">【高优先级 - 针对薄弱环节】:</strong><ul>`; highPrioritySuggestions.forEach(item => { htmlContent += `<li><strong>${item.name}:</strong> ${item.suggestion}</li>`; }); htmlContent += `</ul></li>`; } if (mediumPrioritySuggestions.length > 0) { htmlContent += `<li><strong class="priority-medium">【中优先级 - 针对有提升空间的领域】:</strong><ul>`; mediumPrioritySuggestions.forEach(item => { htmlContent += `<li><strong>${item.name}:</strong> ${item.suggestion}</li>`; }); htmlContent += `</ul></li>`; } if (lowPrioritySuggestions.length > 0) { htmlContent += `<li><strong class="priority-low">【持续保持 - 针对优势领域】:</strong><ul>`; lowPrioritySuggestions.forEach(item => { htmlContent += `<li><strong>${item.name}:</strong> ${item.suggestion}</li>`; }); htmlContent += `</ul></li>`; } if(highPrioritySuggestions.length === 0 && mediumPrioritySuggestions.length === 0 && lowPrioritySuggestions.length === 0){ htmlContent += "<li>各项指标均表现出色，建议持续关注行业最佳实践和新兴威胁。</li>"; } htmlContent += `</ol> <h2>7. 结语</h2><p>建议根据本报告提出的改进建议，结合实际业务情况，制定详细的行动计划，并定期复评（如每年）以跟踪进展和效果。</p> </body></html> `;
            const blob = new Blob([htmlContent], { type: 'application/msword;charset=utf-8' }); const link = document.createElement("a"); const url = URL.createObjectURL(blob); link.setAttribute("href", url); const safeTime = reportData.assessmentTime.replace(/[\/:]/g, '-').replace(/\s/g, '_'); const filename = `安全统筹域评估报告_${safeTime}.doc`; link.setAttribute("download", filename); link.style.visibility = 'hidden'; document.body.appendChild(link); link.click(); document.body.removeChild(link); URL.revokeObjectURL(url);
        }

        // --- Generate Excel Report ---
        function generateExcelReport() {
            // ... Excel report generation function remains unchanged ...
             if (!reportData) { alert("错误：请先完成评估并点击“计算得分”按钮。"); return; }
            try {
                const excelData = []; excelData.push(["安全统筹域评估报告"]); excelData.push([]); excelData.push(["评估日期:", reportData.assessmentTime]); excelData.push(["评估对象:", "[请填写评估对象]"]); excelData.push(["总体得分:", `${reportData.overallScore} / 5.00`]); excelData.push([]); excelData.push(["二级指标", "二级指标得分", "二级指标权重", "三级指标", "三级指标原始得分", "三级指标权重", "选择的描述"]);
                reportData.l2Results.forEach(l2 => { const l2Def = assessmentData.indicatorsL2.find(item => item.name === l2.name); if (l2.l3Details && l2.l3Details.length > 0) { l2.l3Details.forEach((l3, index) => { const l3Def = l2Def?.indicatorsL3.find(item => item.name === l3.name); const l3Weight = l3Def ? l3Def.weight : 'N/A'; excelData.push([ index === 0 ? l2.name : "", index === 0 ? l2.score : "", index === 0 ? (l2.weight * 100).toFixed(0) + "%" : "", l3.name, l3.score, l3Weight !== 'N/A' ? (l3Weight * 100).toFixed(0) + "%" : 'N/A', l3.description ]); }); } else { excelData.push([ l2.name, l2.score, (l2.weight * 100).toFixed(0) + "%", "N/A", "N/A", "N/A", "N/A" ]); } excelData.push([]); });
                const ws = XLSX.utils.aoa_to_sheet(excelData); ws['!cols'] = [ { wch: 15 }, { wch: 15 }, { wch: 15 }, { wch: 25 }, { wch: 18 }, { wch: 15 }, { wch: 80 } ];
                const wb = XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb, ws, "评估结果");
                const excelBuffer = XLSX.write(wb, { bookType: 'xlsx', type: 'array' }); const blob = new Blob([excelBuffer], { type: "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8" });
                const link = document.createElement("a"); const url = URL.createObjectURL(blob); link.setAttribute("href", url); const safeTime = reportData.assessmentTime.replace(/[\/:]/g, '-').replace(/\s/g, '_'); const filename = `安全统筹域评估报告_${safeTime}.xlsx`; link.setAttribute("download", filename); link.style.visibility = 'hidden'; document.body.appendChild(link); link.click(); document.body.removeChild(link); URL.revokeObjectURL(url);
            } catch (error) { console.error("生成Excel报告时出错:", error); alert("生成Excel报告失败，请查看控制台了解详情。"); }
        }

    </script>

</body>
</html>